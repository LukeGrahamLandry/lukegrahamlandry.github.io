<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title> Modding Tutorial </title>

    <link rel="shortcut icon" href="./img/logo.png">
    <link rel="stylesheet" href="./styles/tutorial.css">
    <link rel="stylesheet" href="./styles/md.css">
    <link rel="stylesheet" id="theme" href="">
</head>
<body>
    <div class="hide-for-print" style="max-width: 800px; width: 100%; text-align: left; display: inline-block;">
        <a href="/" style="font-size: 2rem;">Home</a> 
        <label class="switch" style="float: right;">
            <input type="checkbox" id="dark" onclick="updateDarkmode()">
            <span class="slider round"></span>
        </label>
    </div> <br> <br>

    
    <div id="content" class="markdown-body">
        <p>A tutorial on making items with unique custom behaviours. We will make a food that gives a potion effect, a furnace fuel and an item that teleports you forward when right clicked.</p>
<h2>Food</h2>
<p>In your ItemInit class copy the code for a basic item and change the names.</p>
<pre><code>public static final RegistryObject&lt;Item&gt; FRUIT = ITEMS.register("fruit",
            () -&gt; new Item(new Item.Properties().tab(ModCreativeTab.instance)));
</code></pre>
<p>Then on the Item.Properties, call the food function. This takes in a Food created with a Food.Builder. The Food.Builder has a variety of functions that let you set different properties of the food. For example, nutrition lets you set how much hunger it restores. When you're done call build to create the Food object.</p>
<pre><code>new Item.Properties().tab(ModCreativeTab.instance)
                    .food(new Food.Builder().nutrition(4).saturationMod(2).build()
</code></pre>
<p>To make your food grant a potion effect when eaten, call the effect function of your Food.Builder (before you call build). This takes a supplier for an EffectInstance which takes the effect you want to give, the duration (in ticks so 20 is one second), and the amplifier (0 is level I). The effect method also takes the likelihood your effect will be applied (1.0F is always and 0F is never). So this code will have a 50% chance to give fire resistance I for 10 seconds.</p>
<pre><code>.effect(() -&gt; new EffectInstance(Effects.FIRE_RESISTANCE, 200, 0), 0.5F)
</code></pre>
<h2>Fuel</h2>
<p>Again, start by copying the basic item code and change the names. This time change the supplier from an Item to a new class you will create soon.</p>
<pre><code>public static final RegistryObject&lt;Item&gt; FUEL = ITEMS.register("fuel",
            () -&gt; new FuelItem(new Item.Properties().tab(ModCreativeTab.instance)));
</code></pre>
<p>Make a new package called items and create the FuelItem class you referenced when making the item. It should extend Item and have a constructor that takes both an Item.Properties to pass on to the super constructor and an int to use as burn time. Don't forget to make a field to save that burn time.</p>
<pre><code>public class FuelItem extends Item {
    private final int burnTicks;
    public FuelItem(Properties properties, int burnTimeInTicks) {
        super(properties);
        this.burnTicks = burnTimeInTicks;
    }
}
</code></pre>
<p>Then override the getBurnTime method. This takes the itemStack being used as fuel and returns the burn time in ticks. It will return the int we saved from the constructor. </p>
<pre><code>@Override
public int getBurnTime(ItemStack itemStack) {
    return this.burnTicks;
}
</code></pre>
<p>Now go back to ItemInit, import this class and update the constructor when you create your fuel item to include the burn time. Items generally take 200 ticks to smelt so 3200 should cook 16 items (twice as much as coal).</p>
<pre><code>new FuelItem(&lt;...&gt;, 3200)
</code></pre>
<h2>Right click behaviour</h2>
<p>Start the same way as for a fuel. In ItemInit, copy paste basic item, rename and change the class. Make a new class in your items package that extends item and uses the default constructer.</p>
<pre><code>// ItemInit.java

public static final RegistryObject&lt;Item&gt; TELEPORT_STAFF = ITEMS.register("teleport_staff",
            () -&gt; new TeleportStaff(new Item.Properties().tab(ModCreativeTab.instance)));

// items/TeleportStaff.java

public class TeleportStaff extends Item {
    public TeleportStaff(Properties properties) {
        super(properties);
    }
}
</code></pre>
<p>To do something when it's right clicked, override use. It takes in the world which lets you effect blocks and stuff, the player that used it and whether it was main or offhand.</p>
<pre><code>@Override
public ActionResult&lt;ItemStack&gt; use(World world, PlayerEntity player, Hand hand) {
    return super.use(world, player, hand);
}
</code></pre>
<p>So in that method we can use a function built into the item class to do a raycast in the direction the player is looking and save the first thing it hits in a variable. Then we can set the player's position to that position. That will teleport the player forward.</p>
<pre><code>BlockRayTraceResult ray = getPlayerPOVHitResult(world, player, RayTraceContext.FluidMode.NONE);
BlockPos lookPos = ray.getBlockPos();
player.setPos(lookPos.getX(), lookPos.getY(), lookPos.getZ());
</code></pre>
<p>If you tried it now you'd notice that when you try to teleport straight down it you get your feet stuck in the block. This is because we told it to literally set your feet to the same place as the block. We can update the line creating lookPos to offset the position based on the direction you're looking at the block.</p>
<pre><code>BlockPos lookPos = ray.getBlockPos().relative(ray.getDirection());
</code></pre>
<p>Currently the range of the teleport is just the players mining range. To fix that, we can make our own version of this getPlayerPOVHitResult method. If you command click (MacOS Intellij, idk what it is for windows) on the method you can jump to its declaration in the Item class. Its a bunch of confusing math but we can just copy it into our class and try to figure it out. </p>
<p>You can see its getting the position of the player's eyes, then calculating the direction you're looking and multiplying that by this a float called d0. So if you change that, you change the length of the vector and thus the range. If there's no block close in front of you, you'll just teleport the full distance. Let's just name our new function something different so we can be sure we aren't messing up any other behaviours. Don't forget to switch the use method to be using our new rayTrace.</p>
<pre><code>protected static BlockRayTraceResult rayTrace(World world, PlayerEntity player, RayTraceContext.FluidMode fluidMode) {
        double range = 15;

        float f = player.xRot;
        float f1 = player.yRot;
        Vector3d vector3d = player.getEyePosition(1.0F);
        float f2 = MathHelper.cos(-f1 * ((float)Math.PI / 180F) - (float)Math.PI);
        float f3 = MathHelper.sin(-f1 * ((float)Math.PI / 180F) - (float)Math.PI);
        float f4 = -MathHelper.cos(-f * ((float)Math.PI / 180F));
        float f5 = MathHelper.sin(-f * ((float)Math.PI / 180F));
        float f6 = f3 * f4;
        float f7 = f2 * f4;
        Vector3d vector3d1 = vector3d.add((double)f6 * range, (double)f5 * range, (double)f7 * range);
        return world.clip(new RayTraceContext(vector3d, vector3d1, RayTraceContext.BlockMode.OUTLINE, fluidMode, player));
    }
</code></pre>
<p>If you want to limit how often the item can be used you can add a cool down. The second argument is the time they have to wait before using it again in ticks (1/20 of a second). You can also make teleporting reset how far you've fallen so you can use the item to escape fall damage.</p>
<pre><code>player.getCooldowns().addCooldown(this, 60);

playerIn.fallDistance = 0F;
</code></pre>
<p>You can also play a sound. This will play the enderman's teleport sound that the player's position. The last two arguments are volume and pitch. </p>
<pre><code>world.playSound(player, player.getX(), player.getY(), player.getZ(), SoundEvents.ENDERMAN_TELEPORT, SoundCategory.PLAYERS, 1.0F, 1.0F);
</code></pre>
<p>If we want to give the players some help understanding our mod, we can add a tool tip when they hover over the item in their inventory. So override appendHoverText and add to the tooltip. The StringTextComponent class is just a string that Minecraft can render.</p>
<pre><code>@Override
public void appendHoverText(ItemStack stack, @Nullable World worldIn, List&lt;ITextComponent&gt; tooltip, ITooltipFlag flagIn) {
    tooltip.add(new StringTextComponent("teleports you where you're looking"));

    super.appendHoverText(stack, worldIn, tooltip, flagIn);
}
</code></pre>
<p>If you want less clutter for the player, you can only show this when they're holding shift. So make a new package called util and a class called KeyboardHelper. Everything here will be static, we can get the game window so we can get user input. Then make some functions to check if they're holding shift, space, or control respectively. For shift and control we are checking both the left and right one. Don't forget to import all these classes. </p>
<pre><code>public class KeyboardHelper {
    private static final long WINDOW = Minecraft.getInstance().getWindow().getWindow();

    @OnlyIn(Dist.CLIENT)
    public static boolean isHoldingShift() {
        return InputMappings.isKeyDown(WINDOW, GLFW.GLFW_KEY_LEFT_SHIFT) || InputMappings.isKeyDown(WINDOW, GLFW.GLFW_KEY_RIGHT_SHIFT);
    }

    @OnlyIn(Dist.CLIENT)
    public static boolean isHoldingControl() {
        return InputMappings.isKeyDown(WINDOW, GLFW.GLFW_KEY_LEFT_CONTROL) || InputMappings.isKeyDown(WINDOW, GLFW.GLFW_KEY_RIGHT_CONTROL);
    }

    @OnlyIn(Dist.CLIENT)
    public static boolean isHoldingSpace() {
        return InputMappings.isKeyDown(WINDOW, GLFW.GLFW_KEY_SPACE);
    }
}
</code></pre>
<p>Then you can change your appendHoverText method to check if the player is holding shift.</p>
<pre><code>if (KeyboardHelper.isHoldingShift()){
    tooltip.add(new StringTextComponent("teleports you where you're looking"));
}
</code></pre>
<p>If you want it to use durability you can get the item stack being used, increase how damaged it is (because its stored as how much damage has been taken not how much durability remains). Note that setting the damage doesn't make it break when it hits 0. So we have to check if its zero and if so make the stack empty.</p>
<pre><code>ItemStack stack = player.getItemInHand(hand);
stack.setDamageValue(stack.getDamageValue() + 1);
if (stack.getDamageValue() &gt;= stack.getMaxDamage()) stack.setCount(0);
</code></pre>
<p>Then you can go back to ItemInit. Dont forget to import your special item class. If you did the durability thing you have to set the durability to something in the Item.Properties. Giving it durability automatically makes the max stack size one (normally set by the stacksTo method on the properties builder).</p>
<pre><code>new Item.Properties().tab(ModCreativeTab.instance).durability(50)
</code></pre>
<h2>Other Methods</h2>
<p>The <code>Item</code> class has many other methods you can override for interesting behaviour. Here's just a few of them</p>
<ul>
<li><code>useOn</code>: called when right clicked targeting a block</li>
<li><code>interactLivingEntity</code>: called when right clicked targeting an entity</li>
<li><code>hurtEnemy</code>: called when the player hits an entity while holding the item</li>
<li><code>onCraftedBy</code>: called when taken out of a crafting slot. </li>
<li><code>inventoryTick</code>: called once every tick (20 times per second) while it is in someone's inventory. </li>
<li><code>isValidRepairItem</code>: can the second item be used to repair the first item in an anvil</li>
</ul>
<h2>Assets</h2>
<p>You can setup the textures, models and lang file exactly the same as for basic items. Just remember to change the names of the file and any time you use the name of the item.</p>
<h2>Run the game</h2>
<p>If you run the game the items show up in the creative tab and have textures. You can eat the food and sometimes get fire resistance. My fuel coal can be used in a furnace and smelts 16 items. Finally the staff will teleport you and lose durability.</p>
<h2>Extension</h2>
<ul>
<li>
<p>Make an item that replaces any block you right click with dirt</p>
<ul>
<li>hint: <code>world.setBlock(pos, Blocks.VANILLA_NAME.defaultBlockState());</code></li>
</ul>
</li>
<li>
<p>Make an item that gives poison to any entity you right click</p>
<ul>
<li>hint: <code>entity.addEffect(new EffectInstance(Effects.VANILLA_NAME, duration, amplifier));</code></li>
</ul>
</li>
<li>
<p>Make an item that propels the player in the direction they're looking</p>
<ul>
<li>hint: <code>player.setDeltaMovement(x, y, z);</code></li>
</ul>
</li>
<li>
<p>Make an item that places a torch automatically while in the inventory of a player in darkness</p>
<ul>
<li>hint: <code>Math.max(world.getBrightness(LightType.BLOCK, pos), world.getBrightness(LightType.SKY, pos)) &gt; 7</code></li>
</ul>
</li>
</ul> 
    </div>
    

    <div class="hide-for-print">

        <!--

        If you have any questions or suggestions, don't hesitate to ask me on [discord](https://discord.gg/VbZVnRd).

        Also, the full code for all my tutorials is available on [github](https://github.com/LukeGrahamLandry/forge-modding-tutorial/tree/1.16.5).

         -->

        <a href="https://github.com/LukeGrahamLandry/forge-modding-tutorial/tree/1.16.5" class="img-link">
            <div class="app">
                <img src="./img/github.png" style="width: 70px">
            </div>
        </a>

        <a href="https://discord.gg/VbZVnRd" class="img-link">
            <div class="app">
                <img src="./img/discord.png" style="width: 70px">
            </div>
        </a>

        <!--
        <a href="https://www.youtube.com/playlist?list=PLxBLp3RqmUMEU5vrtMY6tgfP2lnJD0OUj" class="img-link">
            <div class="app">
                <img src="img/youtube.png" style="width: 70px">
            </div>
        </a>
        -->

        <a href="https://www.patreon.com/LukeGrahamLandry" class="img-link">
            <div class="app">
                <img src="./img/patreon.png" style="width: 70px">
            </div>
        </a>
    </div>

    <script src="./js/dark.js"></script>
</body>
</html>